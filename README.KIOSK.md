# Kiosk Mode

In kiosk mode, JourneyMaker runs on a local webserver and is managed by several Node.js processes that run in the background. If you intend to use JourneyMaker in kiosk mode, please ensure that you have the correct version of Node installed on your machine.

Briefly, here's what the various Node.js apps do:

| App | Description |
|----------:|-------------|
| AssetDownloader | Retrieves the JSON generated by the JourneyMaker CMS, downloading it and the assets it references to the kiosk localhost. |
| LogServer | Receives event messages from the `App` and logs them to text files. |
| PrintServer | Sends the generated tour booklet to a nearby printer in the galleries. |



## Requirements

Kiosk mode requires the following:

1. node v18.16.0
2. npm 9.5.1 (comes with node)
3. Xcode (Mac OS X, see [nodejs/node-gyp#569](https://github.com/nodejs/node-gyp/issues/569))
4. \*nix environment (Linux, Mac OS X, Free BSD, etc.)
5. Python3 (only used to run a local web server)

## Installation

These installation instructions assume that you have read the [main readme](README.md).

1. Clone this repo to your computer.

2. Run `install.sh` and choose `2` for the kiosk mode. Assuming your prereqisites are in order, it will install the necessary `node_modules` for the Node.js apps.

3. Edit you `config.custom.json`. Set `contentOrigin` to point at the JSON file generated by your JourneyMaker CMS. Set `baseURL` to your virtual host, i.e. to the URL through which you plan to access your JourneyMaker kiosk. For instace, if using SimpleHTTPServer, set it to `http://localhost:8888`

4. Run the AssetDownloader. This will cache the JSON and assets from your JourneyMaker CMS to the kiosk. If installing in a permanent location, this script should be run once on each startup to enable updating of content.

5. Direct your webserver to serve the `App` subfolder. Configuring webservers is beyond the scope of this guide; however, you can try using Python's [SimpleHTTPServer](https://docs.python.org/3.5/library/http.server.html#http.server.SimpleHTTPRequestHandler) or Mac OS X's built-in Apache.

Here is a sample sequence of terminal commands to illustrate the process:

```bash
# Download the repo, e.g. via git clone
git clone https://github.com/art-institute-of-chicago/journeymaker-client

# Enter the repo
cd journeymaker-client

# Run the install script; type 2 for kiosk mode when prompted
chmod 755 install.sh
./install.sh

# Edit your configuration file as desired
# Be sure to set contentOrigin to point at your JourneyMaker CMS
# Set baseURL to your JourneyMaker localhost
nano App/config.custom.json

# Run the AssetDownloader (requires contentOrigin to be set)
./AssetDownloader/download_assets.command

# Run the LogServer and PringServers
open ./LogServer/StartLogServer.command
open ./PrintServer/StartPrintServer.command

# Serve the App folder, e.g. via SimpleHTTPServer
# After running this command, visit http://localhost:8888
python3 -m http.server 8888 --directory App/
```

## Configuration

Please see [main readme](README.md#configuration) for general config options.



### Configuring the Print Server

JourneyMaker utilizes a Node server to generate printable PDFs to be printed on your local network. You can specify the path of the directory that you would like to save PDF's in the `printOutputPath` var. If left unspecified, PDF's will be saved to `/tmp`. The PrintServer will store these PDFs in a local folder, and AIC uses MacOS automation to print new files writted to that folder. By design, all pages are intended to print to 11" x 17" paper. The Art Institute of Chicago additionally utilizes paper that has a pre-printed map on one side to reduce the amount of ink utilized at the time of journey creation.

```javascript
{

    "printOutputPath": "/tmp",

}
```

For more information, see `PrintServer/server.js`




### Configuring Startup Items

For full kiosk operation, add the following items to run at startup items:

1. AssetDownloader/download_assets.command
2. PrintServer/StartPrintServer.command

It is desirable to keep these Node.js processes running in the background using UserAgents, `tmux`, daemons, or similar methods. We use [LaunchControl](http://www.soma-zone.com/LaunchControl/) to manage these services for our kiosks, but feel free to use any method that works for you.
